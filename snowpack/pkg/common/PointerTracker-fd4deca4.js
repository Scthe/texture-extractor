class i{constructor(t){this.id=-1,this.nativePointer=t,this.pageX=t.pageX,this.pageY=t.pageY,this.clientX=t.clientX,this.clientY=t.clientY,self.Touch&&t instanceof Touch?this.id=t.identifier:a(t)&&(this.id=t.pointerId)}getCoalesced(){return"getCoalescedEvents"in this.nativePointer?this.nativePointer.getCoalescedEvents().map(t=>new i(t)):[this]}}const a=c=>self.PointerEvent&&c instanceof PointerEvent,u=()=>{};class E{constructor(t,{start:h=()=>!0,move:m=u,end:l=u,rawUpdates:_=!1}={}){this._element=t,this.startPointers=[],this.currentPointers=[],this._pointerStart=e=>{e.button===0&&(!this._triggerPointerStart(new i(e),e)||(a(e)?((e.target&&"setPointerCapture"in e.target?e.target:this._element).setPointerCapture(e.pointerId),this._element.addEventListener(this._rawUpdates?"pointerrawupdate":"pointermove",this._move),this._element.addEventListener("pointerup",this._pointerEnd),this._element.addEventListener("pointercancel",this._pointerEnd)):(window.addEventListener("mousemove",this._move),window.addEventListener("mouseup",this._pointerEnd))))},this._touchStart=e=>{for(const n of Array.from(e.changedTouches))this._triggerPointerStart(new i(n),e)},this._move=e=>{const n=this.currentPointers.slice(),s="changedTouches"in e?Array.from(e.changedTouches).map(r=>new i(r)):[new i(e)],o=[];for(const r of s){const d=this.currentPointers.findIndex(p=>p.id===r.id);d!==-1&&(o.push(r),this.currentPointers[d]=r)}o.length!==0&&this._moveCallback(n,o,e)},this._triggerPointerEnd=(e,n)=>{const s=this.currentPointers.findIndex(r=>r.id===e.id);if(s===-1)return!1;this.currentPointers.splice(s,1),this.startPointers.splice(s,1);const o=n.type==="touchcancel"||n.type==="pointercancel";return this._endCallback(e,n,o),!0},this._pointerEnd=e=>{if(!!this._triggerPointerEnd(new i(e),e))if(a(e)){if(this.currentPointers.length)return;this._element.removeEventListener(this._rawUpdates?"pointerrawupdate":"pointermove",this._move),this._element.removeEventListener("pointerup",this._pointerEnd),this._element.removeEventListener("pointercancel",this._pointerEnd)}else window.removeEventListener("mousemove",this._move),window.removeEventListener("mouseup",this._pointerEnd)},this._touchEnd=e=>{for(const n of Array.from(e.changedTouches))this._triggerPointerEnd(new i(n),e)},this._startCallback=h,this._moveCallback=m,this._endCallback=l,this._rawUpdates=_&&"onpointerrawupdate"in window,self.PointerEvent?this._element.addEventListener("pointerdown",this._pointerStart):(this._element.addEventListener("mousedown",this._pointerStart),this._element.addEventListener("touchstart",this._touchStart),this._element.addEventListener("touchmove",this._move),this._element.addEventListener("touchend",this._touchEnd),this._element.addEventListener("touchcancel",this._touchEnd))}stop(){this._element.removeEventListener("pointerdown",this._pointerStart),this._element.removeEventListener("mousedown",this._pointerStart),this._element.removeEventListener("touchstart",this._touchStart),this._element.removeEventListener("touchmove",this._move),this._element.removeEventListener("touchend",this._touchEnd),this._element.removeEventListener("touchcancel",this._touchEnd),this._element.removeEventListener(this._rawUpdates?"pointerrawupdate":"pointermove",this._move),this._element.removeEventListener("pointerup",this._pointerEnd),this._element.removeEventListener("pointercancel",this._pointerEnd),window.removeEventListener("mousemove",this._move),window.removeEventListener("mouseup",this._pointerEnd)}_triggerPointerStart(t,h){return this._startCallback(t,h)?(this.currentPointers.push(t),this.startPointers.push(t),!0):!1}}export{E as P};
