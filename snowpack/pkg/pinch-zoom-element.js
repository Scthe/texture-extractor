import{P as v}from"./common/PointerTracker-fd4deca4.js";function C(o,t){t===void 0&&(t={});var n=t.insertAt;if(!(!o||typeof document=="undefined")){var i=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css",n==="top"&&i.firstChild?i.insertBefore(e,i.firstChild):i.appendChild(e),e.styleSheet?e.styleSheet.cssText=o:e.appendChild(document.createTextNode(o))}}var w=`pinch-zoom {
  display: block;
  overflow: hidden;
  touch-action: none;
  --scale: 1;
  --x: 0;
  --y: 0;
}

pinch-zoom > * {
  transform: translate(var(--x), var(--y)) scale(var(--scale));
  transform-origin: 0 0;
  will-change: transform;
}
`;C(w);const f="min-scale";function d(o,t){return t?Math.sqrt((t.clientX-o.clientX)**2+(t.clientY-o.clientY)**2):0}function p(o,t){return t?{clientX:(o.clientX+t.clientX)/2,clientY:(o.clientY+t.clientY)/2}:o}function m(o,t){return typeof o=="number"?o:o.trimRight().endsWith("%")?t*parseFloat(o)/100:parseFloat(o)}let y;function _(){return y||(y=document.createElementNS("http://www.w3.org/2000/svg","svg"))}function g(){return _().createSVGMatrix()}function E(){return _().createSVGPoint()}const u=.01;class x extends HTMLElement{constructor(){super();this._transform=g(),new MutationObserver(()=>this._stageElChange()).observe(this,{childList:!0});const t=new v(this,{start:(n,i)=>t.currentPointers.length===2||!this._positioningEl?!1:(i.preventDefault(),!0),move:n=>{this._onPointerMove(n,t.currentPointers)}});this.addEventListener("wheel",n=>this._onWheel(n))}static get observedAttributes(){return[f]}attributeChangedCallback(t,n,i){t===f&&this.scale<this.minScale&&this.setTransform({scale:this.minScale})}get minScale(){const t=this.getAttribute(f);if(!t)return u;const n=parseFloat(t);return Number.isFinite(n)?Math.max(u,n):u}set minScale(t){this.setAttribute(f,String(t))}connectedCallback(){this._stageElChange()}get x(){return this._transform.e}get y(){return this._transform.f}get scale(){return this._transform.a}scaleTo(t,n={}){let{originX:i=0,originY:e=0}=n;const{relativeTo:r="content",allowChangeEvent:a=!1}=n,l=r==="content"?this._positioningEl:this;if(!l||!this._positioningEl){this.setTransform({scale:t,allowChangeEvent:a});return}const s=l.getBoundingClientRect();if(i=m(i,s.width),e=m(e,s.height),r==="content")i+=this.x,e+=this.y;else{const c=this._positioningEl.getBoundingClientRect();i-=c.left,e-=c.top}this._applyChange({allowChangeEvent:a,originX:i,originY:e,scaleDiff:t/this.scale})}setTransform(t={}){const{scale:n=this.scale,allowChangeEvent:i=!1}=t;let{x:e=this.x,y:r=this.y}=t;if(!this._positioningEl){this._updateTransform(n,e,r,i);return}const a=this.getBoundingClientRect(),l=this._positioningEl.getBoundingClientRect();if(!a.width||!a.height){this._updateTransform(n,e,r,i);return}let s=E();s.x=l.left-a.left,s.y=l.top-a.top;let c=E();c.x=l.width+s.x,c.y=l.height+s.y;const h=g().translate(e,r).scale(n).multiply(this._transform.inverse());s=s.matrixTransform(h),c=c.matrixTransform(h),s.x>a.width?e+=a.width-s.x:c.x<0&&(e+=-c.x),s.y>a.height?r+=a.height-s.y:c.y<0&&(r+=-c.y),this._updateTransform(n,e,r,i)}_updateTransform(t,n,i,e){if(!(t<this.minScale)&&!(t===this.scale&&n===this.x&&i===this.y)&&(this._transform.e=n,this._transform.f=i,this._transform.d=this._transform.a=t,this.style.setProperty("--x",this.x+"px"),this.style.setProperty("--y",this.y+"px"),this.style.setProperty("--scale",this.scale+""),e)){const r=new Event("change",{bubbles:!0});this.dispatchEvent(r)}}_stageElChange(){this._positioningEl=void 0,this.children.length!==0&&(this._positioningEl=this.children[0],this.children.length>1&&console.warn("<pinch-zoom> must not have more than one child."),this.setTransform({allowChangeEvent:!0}))}_onWheel(t){if(!this._positioningEl)return;t.preventDefault();const n=this._positioningEl.getBoundingClientRect();let{deltaY:i}=t;const{ctrlKey:e,deltaMode:r}=t;r===1&&(i*=15);const l=1-i/(e?100:300);this._applyChange({scaleDiff:l,originX:t.clientX-n.left,originY:t.clientY-n.top,allowChangeEvent:!0})}_onPointerMove(t,n){if(!this._positioningEl)return;const i=this._positioningEl.getBoundingClientRect(),e=p(t[0],t[1]),r=p(n[0],n[1]),a=e.clientX-i.left,l=e.clientY-i.top,s=d(t[0],t[1]),c=d(n[0],n[1]),h=s?c/s:1;this._applyChange({originX:a,originY:l,scaleDiff:h,panX:r.clientX-e.clientX,panY:r.clientY-e.clientY,allowChangeEvent:!0})}_applyChange(t={}){const{panX:n=0,panY:i=0,originX:e=0,originY:r=0,scaleDiff:a=1,allowChangeEvent:l=!1}=t,s=g().translate(n,i).translate(e,r).translate(this.x,this.y).scale(a).translate(-e,-r).scale(this.scale);this.setTransform({allowChangeEvent:l,scale:s.a,x:s.e,y:s.f})}}customElements.define("pinch-zoom",x);export default x;
