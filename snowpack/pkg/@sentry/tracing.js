import{g as W,p,a as l,N as M,O as N,t as Z,l as G,M as ee,P as he,r as ve,Q as te,R as ie,T as F,_ as E,U as H,E as q,V as A,K as ne,A as ge,C as re,H as Y,z as ae,m as _e}from"../common/hub-e13ed0b5.js";import{b as x}from"../common/instrument-ebfec453.js";var R;(function(t){t.Explicit="explicitly_set",t.Sampler="client_sampler",t.Rate="client_rate",t.Inheritance="inheritance"})(R||(R={}));var y;(function(t){t.Ok="ok",t.DeadlineExceeded="deadline_exceeded",t.Unauthenticated="unauthenticated",t.PermissionDenied="permission_denied",t.NotFound="not_found",t.ResourceExhausted="resource_exhausted",t.InvalidArgument="invalid_argument",t.Unimplemented="unimplemented",t.Unavailable="unavailable",t.InternalError="internal_error",t.UnknownError="unknown_error",t.Cancelled="cancelled",t.AlreadyExists="already_exists",t.FailedPrecondition="failed_precondition",t.Aborted="aborted",t.OutOfRange="out_of_range",t.DataLoss="data_loss"})(y||(y={})),function(t){function e(i){if(i<400)return t.Ok;if(i>=400&&i<500)switch(i){case 401:return t.Unauthenticated;case 403:return t.PermissionDenied;case 404:return t.NotFound;case 409:return t.AlreadyExists;case 413:return t.FailedPrecondition;case 429:return t.ResourceExhausted;default:return t.InvalidArgument}if(i>=500&&i<600)switch(i){case 501:return t.Unimplemented;case 503:return t.Unavailable;case 504:return t.DeadlineExceeded;default:return t.InternalError}return t.UnknownError}t.fromHttpCode=e}(y||(y={}));var Te=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function X(t){t===void 0&&(t=(e=W().getClient())===null||e===void 0?void 0:e.getOptions());var e;return t?"tracesSampleRate"in t||"tracesSampler"in t:!1}function ye(t){var e=t.match(Te);if(e){var i=void 0;return e[3]==="1"?i=!0:e[3]==="0"&&(i=!1),{traceId:e[1],parentSampled:i,parentSpanId:e[2]}}}function P(t){t===void 0&&(t=W());var e,i;return(i=(e=t)===null||e===void 0?void 0:e.getScope())===null||i===void 0?void 0:i.getTransaction()}function T(t){return t/1e3}function be(t){return t*1e3}function Se(){x({callback:se,type:"error"}),x({callback:se,type:"unhandledrejection"})}function se(){var t=P();t&&(p.log("[Tracing] Transaction: "+y.InternalError+" -> Global error occured"),t.setStatus(y.InternalError))}var oe=function(){function t(e){e===void 0&&(e=1e3),this.spans=[],this._maxlen=e}return t.prototype.add=function(e){this.spans.length>this._maxlen?e.spanRecorder=void 0:this.spans.push(e)},t}(),Ie=function(){function t(e){if(this.traceId=Z(),this.spanId=Z().substring(16),this.startTimestamp=M(),this.tags={},this.data={},!e)return this;e.traceId&&(this.traceId=e.traceId),e.spanId&&(this.spanId=e.spanId),e.parentSpanId&&(this.parentSpanId=e.parentSpanId),"sampled"in e&&(this.sampled=e.sampled),e.op&&(this.op=e.op),e.description&&(this.description=e.description),e.data&&(this.data=e.data),e.tags&&(this.tags=e.tags),e.status&&(this.status=e.status),e.startTimestamp&&(this.startTimestamp=e.startTimestamp),e.endTimestamp&&(this.endTimestamp=e.endTimestamp)}return t.prototype.child=function(e){return this.startChild(e)},t.prototype.startChild=function(e){var i=new t(l(l({},e),{parentSpanId:this.spanId,sampled:this.sampled,traceId:this.traceId}));return i.spanRecorder=this.spanRecorder,i.spanRecorder&&i.spanRecorder.add(i),i.transaction=this.transaction,i},t.prototype.setTag=function(e,i){var n;return this.tags=l(l({},this.tags),(n={},n[e]=i,n)),this},t.prototype.setData=function(e,i){var n;return this.data=l(l({},this.data),(n={},n[e]=i,n)),this},t.prototype.setStatus=function(e){return this.status=e,this},t.prototype.setHttpStatus=function(e){this.setTag("http.status_code",String(e));var i=y.fromHttpCode(e);return i!==y.UnknownError&&this.setStatus(i),this},t.prototype.isSuccess=function(){return this.status===y.Ok},t.prototype.finish=function(e){this.endTimestamp=typeof e=="number"?e:M()},t.prototype.toTraceparent=function(){var e="";return this.sampled!==void 0&&(e=this.sampled?"-1":"-0"),this.traceId+"-"+this.spanId+e},t.prototype.toContext=function(){return N({data:this.data,description:this.description,endTimestamp:this.endTimestamp,op:this.op,parentSpanId:this.parentSpanId,sampled:this.sampled,spanId:this.spanId,startTimestamp:this.startTimestamp,status:this.status,tags:this.tags,traceId:this.traceId})},t.prototype.updateWithContext=function(e){var i,n,r,s,a;return this.data=(i=e.data,i!=null?i:{}),this.description=e.description,this.endTimestamp=e.endTimestamp,this.op=e.op,this.parentSpanId=e.parentSpanId,this.sampled=e.sampled,this.spanId=(n=e.spanId,n!=null?n:this.spanId),this.startTimestamp=(r=e.startTimestamp,r!=null?r:this.startTimestamp),this.status=e.status,this.tags=(s=e.tags,s!=null?s:{}),this.traceId=(a=e.traceId,a!=null?a:this.traceId),this},t.prototype.getTraceContext=function(){return N({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,trace_id:this.traceId})},t.prototype.toJSON=function(){return N({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,start_timestamp:this.startTimestamp,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,timestamp:this.endTimestamp,trace_id:this.traceId})},t}(),de=function(t){G(e,t);function e(i,n){var r=t.call(this,i)||this;return r._measurements={},r._hub=W(),ee(n,he)&&(r._hub=n),r.name=i.name||"",r.metadata=i.metadata||{},r._trimEnd=i.trimEnd,r.transaction=r,r}return e.prototype.setName=function(i){this.name=i},e.prototype.initSpanRecorder=function(i){i===void 0&&(i=1e3),this.spanRecorder||(this.spanRecorder=new oe(i)),this.spanRecorder.add(this)},e.prototype.setMeasurements=function(i){this._measurements=l({},i)},e.prototype.setMetadata=function(i){this.metadata=l(l({},this.metadata),i)},e.prototype.finish=function(i){var n=this;if(this.endTimestamp===void 0){if(this.name||(p.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this.name="<unlabeled transaction>"),t.prototype.finish.call(this,i),this.sampled!==!0){p.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled.");return}var r=this.spanRecorder?this.spanRecorder.spans.filter(function(o){return o!==n&&o.endTimestamp}):[];this._trimEnd&&r.length>0&&(this.endTimestamp=r.reduce(function(o,d){return o.endTimestamp&&d.endTimestamp?o.endTimestamp>d.endTimestamp?o:d:o}).endTimestamp);var s={contexts:{trace:this.getTraceContext()},spans:r,start_timestamp:this.startTimestamp,tags:this.tags,timestamp:this.endTimestamp,transaction:this.name,type:"transaction",debug_meta:this.metadata},a=Object.keys(this._measurements).length>0;return a&&(p.log("[Measurements] Adding measurements to transaction",JSON.stringify(this._measurements,void 0,2)),s.measurements=this._measurements),p.log("[Tracing] Finishing "+this.op+" transaction: "+this.name+"."),this._hub.captureEvent(s)}},e.prototype.toContext=function(){var i=t.prototype.toContext.call(this);return N(l(l({},i),{name:this.name,trimEnd:this._trimEnd}))},e.prototype.updateWithContext=function(i){var n;return t.prototype.updateWithContext.call(this,i),this.name=(n=i.name,n!=null?n:""),this._trimEnd=i.trimEnd,this},e}(Ie),ce=1e3,Ee=function(t){G(e,t);function e(i,n,r,s){r===void 0&&(r="");var a=t.call(this,s)||this;return a._pushActivity=i,a._popActivity=n,a.transactionSpanId=r,a}return e.prototype.add=function(i){var n=this;i.spanId!==this.transactionSpanId&&(i.finish=function(r){i.endTimestamp=typeof r=="number"?r:M(),n._popActivity(i.spanId)},i.endTimestamp===void 0&&this._pushActivity(i.spanId)),t.prototype.add.call(this,i)},e}(oe),Oe=function(t){G(e,t);function e(i,n,r,s){r===void 0&&(r=ce),s===void 0&&(s=!1);var a=t.call(this,i,n)||this;return a._idleHub=n,a._idleTimeout=r,a._onScope=s,a.activities={},a._heartbeatTimer=0,a._heartbeatCounter=0,a._finished=!1,a._beforeFinishCallbacks=[],n&&s&&(ue(n),p.log("Setting idle transaction on scope. Span ID: "+a.spanId),n.configureScope(function(o){return o.setSpan(a)})),a._initTimeout=setTimeout(function(){a._finished||a.finish()},a._idleTimeout),a}return e.prototype.finish=function(i){var n,r,s=this;if(i===void 0&&(i=M()),this._finished=!0,this.activities={},this.spanRecorder){p.log("[Tracing] finishing IdleTransaction",new Date(i*1e3).toISOString(),this.op);try{for(var a=ve(this._beforeFinishCallbacks),o=a.next();!o.done;o=a.next()){var d=o.value;d(this,i)}}catch(f){n={error:f}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}this.spanRecorder.spans=this.spanRecorder.spans.filter(function(f){if(f.spanId===s.spanId)return!0;f.endTimestamp||(f.endTimestamp=i,f.setStatus(y.Cancelled),p.log("[Tracing] cancelling span since transaction ended early",JSON.stringify(f,void 0,2)));var c=f.startTimestamp<i;return c||p.log("[Tracing] discarding Span since it happened after Transaction was finished",JSON.stringify(f,void 0,2)),c}),p.log("[Tracing] flushing IdleTransaction")}else p.log("[Tracing] No active IdleTransaction");return this._onScope&&ue(this._idleHub),t.prototype.finish.call(this,i)},e.prototype.registerBeforeFinishCallback=function(i){this._beforeFinishCallbacks.push(i)},e.prototype.initSpanRecorder=function(i){var n=this;if(!this.spanRecorder){var r=function(a){n._finished||n._pushActivity(a)},s=function(a){n._finished||n._popActivity(a)};this.spanRecorder=new Ee(r,s,this.spanId,i),p.log("Starting heartbeat"),this._pingHeartbeat()}this.spanRecorder.add(this)},e.prototype._pushActivity=function(i){this._initTimeout&&(clearTimeout(this._initTimeout),this._initTimeout=void 0),p.log("[Tracing] pushActivity: "+i),this.activities[i]=!0,p.log("[Tracing] new activities count",Object.keys(this.activities).length)},e.prototype._popActivity=function(i){var n=this;if(this.activities[i]&&(p.log("[Tracing] popActivity "+i),delete this.activities[i],p.log("[Tracing] new activities count",Object.keys(this.activities).length)),Object.keys(this.activities).length===0){var r=this._idleTimeout,s=M()+r/1e3;setTimeout(function(){n._finished||n.finish(s)},r)}},e.prototype._beat=function(){if(clearTimeout(this._heartbeatTimer),!this._finished){var i=Object.keys(this.activities),n=i.length?i.reduce(function(r,s){return r+s}):"";n===this._prevHeartbeatString?this._heartbeatCounter+=1:this._heartbeatCounter=1,this._prevHeartbeatString=n,this._heartbeatCounter>=3?(p.log("[Tracing] Transaction finished because of no change for 3 heart beats"),this.setStatus(y.DeadlineExceeded),this.setTag("heartbeat","failed"),this.finish()):this._pingHeartbeat()}},e.prototype._pingHeartbeat=function(){var i=this;p.log("pinging Heartbeat -> current counter: "+this._heartbeatCounter),this._heartbeatTimer=setTimeout(function(){i._beat()},5e3)},e}(de);function ue(t){if(t){var e=t.getScope();if(e){var i=e.getTransaction();i&&e.setSpan(void 0)}}}function Re(){var t=this.getScope();if(t){var e=t.getSpan();if(e)return{"sentry-trace":e.toTraceparent()}}return{}}function fe(t,e,i){if(!X())return t.sampled=!1,t;if(t.sampled!==void 0)return t.setMetadata({transactionSampling:{method:R.Explicit}}),t;var n;return typeof e.tracesSampler=="function"?(n=e.tracesSampler(i),t.setMetadata({transactionSampling:{method:R.Sampler,rate:Number(n)}})):i.parentSampled!==void 0?(n=i.parentSampled,t.setMetadata({transactionSampling:{method:R.Inheritance}})):(n=e.tracesSampleRate,t.setMetadata({transactionSampling:{method:R.Rate,rate:Number(n)}})),ke(n)?n?(t.sampled=Math.random()<n,t.sampled?(p.log("[Tracing] starting "+t.op+" transaction - "+t.name),t):(p.log("[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = "+Number(n)+")"),t)):(p.log("[Tracing] Discarding transaction because "+(typeof e.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0")),t.sampled=!1,t):(p.warn("[Tracing] Discarding transaction because of invalid sample rate."),t.sampled=!1,t)}function ke(t){return isNaN(t)||!(typeof t=="number"||typeof t=="boolean")?(p.warn("[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got "+JSON.stringify(t)+" of type "+JSON.stringify(typeof t)+"."),!1):t<0||t>1?(p.warn("[Tracing] Given sample rate is invalid. Sample rate must be between 0 and 1. Got "+t+"."),!1):!0}function we(t,e){var i,n,r=((i=this.getClient())===null||i===void 0?void 0:i.getOptions())||{},s=new de(t,this);return s=fe(s,r,l({parentSampled:t.parentSampled,transactionContext:t},e)),s.sampled&&s.initSpanRecorder((n=r._experiments)===null||n===void 0?void 0:n.maxSpans),s}function Me(t,e,i,n,r){var s,a,o=((s=t.getClient())===null||s===void 0?void 0:s.getOptions())||{},d=new Oe(e,t,i,n);return d=fe(d,o,l({parentSampled:e.parentSampled,transactionContext:e},r)),d.sampled&&d.initSpanRecorder((a=o._experiments)===null||a===void 0?void 0:a.maxSpans),d}function Ae(){var t=ie();!t.__SENTRY__||(t.__SENTRY__.extensions=t.__SENTRY__.extensions||{},t.__SENTRY__.extensions.startTransaction||(t.__SENTRY__.extensions.startTransaction=we),t.__SENTRY__.extensions.traceHeaders||(t.__SENTRY__.extensions.traceHeaders=Re))}function xe(){var t=ie();if(!!t.__SENTRY__){var e={mongodb:function(){var n=H(module,"./integrations/mongo");return new n.Mongo},mongoose:function(){var n=H(module,"./integrations/mongo");return new n.Mongo({mongoose:!0})},mysql:function(){var n=H(module,"./integrations/mysql");return new n.Mysql},pg:function(){var n=H(module,"./integrations/postgres");return new n.Postgres}},i=Object.keys(e).filter(function(n){return!!F(n)}).map(function(n){try{return e[n]()}catch(r){return}}).filter(function(n){return n});i.length>0&&(t.__SENTRY__.integrations=E(t.__SENTRY__.integrations||[],i))}}function Ce(){Ae(),te()&&xe(),Se()}var D=q();function Ne(){D&&D.document?D.document.addEventListener("visibilitychange",function(){var t=P();D.document.hidden&&t&&(p.log("[Tracing] Transaction: "+y.Cancelled+" -> since tab moved to the background, op: "+t.op),t.status||t.setStatus(y.Cancelled),t.setTag("visibilitychange","document.hidden"),t.finish())}):p.warn("[Tracing] Could not set up background tab detection due to lack of global document")}var J=function(t,e,i,n){var r;return function(){i&&e.isFinal&&i.disconnect(),e.value>=0&&(n||e.isFinal||document.visibilityState==="hidden")&&(e.delta=e.value-(r||0),(e.delta||e.isFinal||r===void 0)&&(t(e),r=e.value))}},Fe=function(){return Date.now()+"-"+(Math.floor(Math.random()*(9e12-1))+1e12)},V=function(t,e){return e===void 0&&(e=-1),{name:t,value:e,delta:0,entries:[],id:Fe(),isFinal:!1}},$=function(t,e){try{if(PerformanceObserver.supportedEntryTypes.includes(t)){var i=new PerformanceObserver(function(n){return n.getEntries().map(e)});return i.observe({type:t,buffered:!0}),i}}catch(n){}},pe=!1,le=!1,He=function(t){pe=!t.persisted},qe=function(){addEventListener("pagehide",He),addEventListener("beforeunload",function(){})},L=function(t,e){e===void 0&&(e=!1),le||(qe(),le=!0),addEventListener("visibilitychange",function(i){var n=i.timeStamp;document.visibilityState==="hidden"&&t({timeStamp:n,isUnloading:pe})},{capture:!0,once:e})},Pe=function(t,e){e===void 0&&(e=!1);var i=V("CLS",0),n,r=function(a){a.hadRecentInput||(i.value+=a.value,i.entries.push(a),n())},s=$("layout-shift",r);s&&(n=J(t,i,s,e),L(function(a){var o=a.isUnloading;s.takeRecords().map(r),o&&(i.isFinal=!0),n()}))},U,K=function(){return U===void 0&&(U=document.visibilityState==="hidden"?0:Infinity,L(function(t){var e=t.timeStamp;return U=e},!0)),{get timeStamp(){return U}}},De=function(t){var e=V("FID"),i=K(),n=function(a){a.startTime<i.timeStamp&&(e.value=a.processingStart-a.startTime,e.entries.push(a),e.isFinal=!0,s())},r=$("first-input",n),s=J(t,e,r);r?L(function(){r.takeRecords().map(n),r.disconnect()},!0):window.perfMetrics&&window.perfMetrics.onFirstInputDelay&&window.perfMetrics.onFirstInputDelay(function(a,o){o.timeStamp<i.timeStamp&&(e.value=a,e.isFinal=!0,e.entries=[{entryType:"first-input",name:o.type,target:o.target,cancelable:o.cancelable,startTime:o.timeStamp,processingStart:o.timeStamp+a}],s())})},Q,Le=function(){return Q||(Q=new Promise(function(t){return["scroll","keydown","pointerdown"].map(function(e){addEventListener(e,t,{once:!0,passive:!0,capture:!0})})})),Q},Ue=function(t,e){e===void 0&&(e=!1);var i=V("LCP"),n=K(),r,s=function(d){var f=d.startTime;f<n.timeStamp?(i.value=f,i.entries.push(d)):i.isFinal=!0,r()},a=$("largest-contentful-paint",s);if(a){r=J(t,i,a,e);var o=function(){i.isFinal||(a.takeRecords().map(s),i.isFinal=!0,r())};Le().then(o),L(o,!0)}},S=q(),Be=function(){function t(){var e;this._measurements={},this._performanceCursor=0,!te()&&((e=S)===null||e===void 0?void 0:e.performance)&&(S.performance.mark&&S.performance.mark("sentry-tracing-init"),this._trackCLS(),this._trackLCP(),this._trackFID())}return t.prototype.addPerformanceEntries=function(e){var i=this;if(!(!S||!S.performance||!S.performance.getEntries||!A)){p.log("[Tracing] Adding & adjusting spans using Performance API");var n=T(A),r;if(S.document){for(var s=0;s<document.scripts.length;s++)if(document.scripts[s].dataset.entry==="true"){r=document.scripts[s].src;break}}var a,o,d,f;if(S.performance.getEntries().slice(this._performanceCursor).forEach(function(u){var m=T(u.startTime),g=T(u.duration);if(!(e.op==="navigation"&&n+m<e.startTimestamp))switch(u.entryType){case"navigation":{je(e,u,n),d=n+T(u.responseStart),f=n+T(u.requestStart);break}case"mark":case"paint":case"measure":{var v=ze(e,u,m,g,n);o===void 0&&u.name==="sentry-tracing-init"&&(o=v);var _=K(),h=u.startTime<_.timeStamp;u.name==="first-paint"&&h&&(p.log("[Measurements] Adding FP"),i._measurements.fp={value:u.startTime},i._measurements["mark.fp"]={value:v}),u.name==="first-contentful-paint"&&h&&(p.log("[Measurements] Adding FCP"),i._measurements.fcp={value:u.startTime},i._measurements["mark.fcp"]={value:v});break}case"resource":{var b=u.name.replace(window.location.origin,""),k=We(e,u,b,m,g,n);a===void 0&&(r||"").indexOf(b)>-1&&(a=k);break}}}),a!==void 0&&o!==void 0&&O(e,{description:"evaluation",endTimestamp:o,op:"script",startTimestamp:a}),this._performanceCursor=Math.max(performance.getEntries().length-1,0),this._trackNavigator(e),e.op==="pageload"){var c=T(A);typeof d=="number"&&(p.log("[Measurements] Adding TTFB"),this._measurements.ttfb={value:(d-e.startTimestamp)*1e3},typeof f=="number"&&f<=d&&(this._measurements["ttfb.requestTime"]={value:(d-f)*1e3})),["fcp","fp","lcp"].forEach(function(u){if(!(!i._measurements[u]||c>=e.startTimestamp)){var m=i._measurements[u].value,g=c+T(m),v=Math.abs((g-e.startTimestamp)*1e3),_=v-m;p.log("[Measurements] Normalized "+u+" from "+m+" to "+v+" ("+_+")"),i._measurements[u].value=v}}),this._measurements["mark.fid"]&&this._measurements.fid&&O(e,{description:"first input delay",endTimestamp:this._measurements["mark.fid"].value+T(this._measurements.fid.value),op:"web.vitals",startTimestamp:this._measurements["mark.fid"].value}),e.setMeasurements(this._measurements),this._tagMetricInfo(e)}}},t.prototype._tagMetricInfo=function(e){this._lcpEntry&&(p.log("[Measurements] Adding LCP Data"),this._lcpEntry.element&&e.setTag("lcp.element",ne(this._lcpEntry.element)),this._lcpEntry.id&&e.setTag("lcp.id",this._lcpEntry.id),this._lcpEntry.url&&e.setTag("lcp.url",this._lcpEntry.url.trim().slice(0,200)),e.setTag("lcp.size",this._lcpEntry.size)),this._clsEntry&&(p.log("[Measurements] Adding CLS Data"),this._clsEntry.sources.map(function(i,n){return e.setTag("cls.source."+(n+1),ne(i.node))}))},t.prototype._trackCLS=function(){var e=this;Pe(function(i){var n=i.entries.pop();!n||(p.log("[Measurements] Adding CLS"),e._measurements.cls={value:i.value},e._clsEntry=n)})},t.prototype._trackNavigator=function(e){var i=S.navigator;if(!!i){var n=i.connection;n&&(n.effectiveType&&e.setTag("effectiveConnectionType",n.effectiveType),n.type&&e.setTag("connectionType",n.type),B(n.rtt)&&(this._measurements["connection.rtt"]={value:n.rtt}),B(n.downlink)&&(this._measurements["connection.downlink"]={value:n.downlink})),B(i.deviceMemory)&&e.setTag("deviceMemory",String(i.deviceMemory)),B(i.hardwareConcurrency)&&e.setTag("hardwareConcurrency",String(i.hardwareConcurrency))}},t.prototype._trackLCP=function(){var e=this;Ue(function(i){var n=i.entries.pop();if(!!n){var r=T(A),s=T(n.startTime);p.log("[Measurements] Adding LCP"),e._measurements.lcp={value:i.value},e._measurements["mark.lcp"]={value:r+s},e._lcpEntry=n}})},t.prototype._trackFID=function(){var e=this;De(function(i){var n=i.entries.pop();if(!!n){var r=T(A),s=T(n.startTime);p.log("[Measurements] Adding FID"),e._measurements.fid={value:i.value},e._measurements["mark.fid"]={value:r+s}}})},t}();function je(t,e,i){I({transaction:t,entry:e,event:"unloadEvent",timeOrigin:i}),I({transaction:t,entry:e,event:"redirect",timeOrigin:i}),I({transaction:t,entry:e,event:"domContentLoadedEvent",timeOrigin:i}),I({transaction:t,entry:e,event:"loadEvent",timeOrigin:i}),I({transaction:t,entry:e,event:"connect",timeOrigin:i}),I({transaction:t,entry:e,event:"secureConnection",timeOrigin:i,eventEnd:"connectEnd",description:"TLS/SSL"}),I({transaction:t,entry:e,event:"fetch",timeOrigin:i,eventEnd:"domainLookupStart",description:"cache"}),I({transaction:t,entry:e,event:"domainLookup",timeOrigin:i,description:"DNS"}),Ge(t,e,i)}function ze(t,e,i,n,r){var s=r+i,a=s+n;return O(t,{description:e.name,endTimestamp:a,op:e.entryType,startTimestamp:s}),s}function We(t,e,i,n,r,s){if(!(e.initiatorType==="xmlhttprequest"||e.initiatorType==="fetch")){var a={};"transferSize"in e&&(a["Transfer Size"]=e.transferSize),"encodedBodySize"in e&&(a["Encoded Body Size"]=e.encodedBodySize),"decodedBodySize"in e&&(a["Decoded Body Size"]=e.decodedBodySize);var o=s+n,d=o+r;return O(t,{description:i,endTimestamp:d,op:e.initiatorType?"resource."+e.initiatorType:"resource",startTimestamp:o,data:a}),d}}function I(t){var e=t.transaction,i=t.entry,n=t.event,r=t.timeOrigin,s=t.eventEnd,a=t.description,o=s?i[s]:i[n+"End"],d=i[n+"Start"];!d||!o||O(e,{op:"browser",description:a!=null?a:n,startTimestamp:r+T(d),endTimestamp:r+T(o)})}function Ge(t,e,i){O(t,{op:"browser",description:"request",startTimestamp:i+T(e.requestStart),endTimestamp:i+T(e.responseEnd)}),O(t,{op:"browser",description:"response",startTimestamp:i+T(e.responseStart),endTimestamp:i+T(e.responseEnd)})}function O(t,e){var i=e.startTimestamp,n=ge(e,["startTimestamp"]);return i&&t.startTimestamp>i&&(t.startTimestamp=i),t.startChild(l({startTimestamp:i},n))}function B(t){return typeof t=="number"&&isFinite(t)}var Ye=["localhost",/^\//],j={traceFetch:!0,traceXHR:!0,tracingOrigins:Ye};function Xe(t){var e=l(l({},j),t),i=e.traceFetch,n=e.traceXHR,r=e.tracingOrigins,s=e.shouldCreateSpanForRequest,a={},o=function(c){if(a[c])return a[c];var u=r;return a[c]=u.some(function(m){return re(c,m)})&&!re(c,"sentry_key"),a[c]},d=o;typeof s=="function"&&(d=function(c){return o(c)&&s(c)});var f={};i&&x({callback:function(c){Je(c,d,f)},type:"fetch"}),n&&x({callback:function(c){Ve(c,d,f)},type:"xhr"})}function Je(t,e,i){if(!(!X()||!(t.fetchData&&e(t.fetchData.url)))){if(t.endTimestamp&&t.fetchData.__span){var n=i[t.fetchData.__span];n&&(t.response?n.setHttpStatus(t.response.status):t.error&&n.setStatus(y.InternalError),n.finish(),delete i[t.fetchData.__span]);return}var r=P();if(r){var n=r.startChild({data:l(l({},t.fetchData),{type:"fetch"}),description:t.fetchData.method+" "+t.fetchData.url,op:"http"});t.fetchData.__span=n.spanId,i[n.spanId]=n;var s=t.args[0]=t.args[0],a=t.args[1]=t.args[1]||{},o=a.headers;ee(s,Request)&&(o=s.headers),o?typeof o.append=="function"?o.append("sentry-trace",n.toTraceparent()):Array.isArray(o)?o=E(o,[["sentry-trace",n.toTraceparent()]]):o=l(l({},o),{"sentry-trace":n.toTraceparent()}):o={"sentry-trace":n.toTraceparent()},a.headers=o}}}function Ve(t,e,i){var n,r;if(!(!X()||((n=t.xhr)===null||n===void 0?void 0:n.__sentry_own_request__)||!(((r=t.xhr)===null||r===void 0?void 0:r.__sentry_xhr__)&&e(t.xhr.__sentry_xhr__.url)))){var s=t.xhr.__sentry_xhr__;if(t.endTimestamp&&t.xhr.__sentry_xhr_span_id__){var a=i[t.xhr.__sentry_xhr_span_id__];a&&(a.setHttpStatus(s.status_code),a.finish(),delete i[t.xhr.__sentry_xhr_span_id__]);return}var o=P();if(o){var a=o.startChild({data:l(l({},s.data),{type:"xhr",method:s.method,url:s.url}),description:s.method+" "+s.url,op:"http"});if(t.xhr.__sentry_xhr_span_id__=a.spanId,i[t.xhr.__sentry_xhr_span_id__]=a,t.xhr.setRequestHeader)try{t.xhr.setRequestHeader("sentry-trace",a.toTraceparent())}catch(f){}}}}var C=q();function $e(t,e,i){if(e===void 0&&(e=!0),i===void 0&&(i=!0),!C||!C.location){p.warn("Could not initialize routing instrumentation due to invalid location");return}var n=C.location.href,r;e&&(r=t({name:C.location.pathname,op:"pageload"})),i&&x({callback:function(s){var a=s.to,o=s.from;if(o===void 0&&n&&n.indexOf(a)!==-1){n=void 0;return}o!==a&&(n=void 0,r&&(p.log("[Tracing] Finishing current transaction with op: "+r.op),r.finish()),r=t({name:C.location.pathname,op:"navigation"}))},type:"history"})}var Ke=600,Qe=l({idleTimeout:ce,markBackgroundTransactions:!0,maxTransactionDuration:Ke,routingInstrumentation:$e,startTransactionOnLocationChange:!0,startTransactionOnPageLoad:!0},j),Ze=function(){function t(e){this.name=t.id,this._metrics=new Be,this._emitOptionsWarning=!1;var i=j.tracingOrigins;e&&e.tracingOrigins&&Array.isArray(e.tracingOrigins)&&e.tracingOrigins.length!==0?i=e.tracingOrigins:this._emitOptionsWarning=!0,this.options=l(l(l({},Qe),e),{tracingOrigins:i})}return t.prototype.setupOnce=function(e,i){var n=this;this._getCurrentHub=i,this._emitOptionsWarning&&(p.warn("[Tracing] You need to define `tracingOrigins` in the options. Set an array of urls or patterns to trace."),p.warn("[Tracing] We added a reasonable default for you: "+j.tracingOrigins));var r=this.options,s=r.routingInstrumentation,a=r.startTransactionOnLocationChange,o=r.startTransactionOnPageLoad,d=r.markBackgroundTransactions,f=r.traceFetch,c=r.traceXHR,u=r.tracingOrigins,m=r.shouldCreateSpanForRequest;s(function(g){return n._createRouteTransaction(g)},o,a),d&&Ne(),Xe({traceFetch:f,traceXHR:c,tracingOrigins:u,shouldCreateSpanForRequest:m})},t.prototype._createRouteTransaction=function(e){var i=this;if(!this._getCurrentHub){p.warn("[Tracing] Did not create "+e.op+" transaction because _getCurrentHub is invalid.");return}var n=this.options,r=n.beforeNavigate,s=n.idleTimeout,a=n.maxTransactionDuration,o=e.op==="pageload"?et():void 0,d=l(l(l({},e),o),{trimEnd:!0}),f=typeof r=="function"?r(d):d,c=f===void 0?l(l({},d),{sampled:!1}):f;c.sampled===!1&&p.log("[Tracing] Will not send "+c.op+" transaction because of beforeNavigate."),p.log("[Tracing] Starting "+c.op+" transaction on scope");var u=this._getCurrentHub(),m=q().location,g=Me(u,c,s,!0,{location:m});return g.registerBeforeFinishCallback(function(v,_){i._metrics.addPerformanceEntries(v),it(be(a),v,_)}),g},t.id="BrowserTracing",t}();function et(){var t=tt("sentry-trace");if(t)return ye(t)}function tt(t){var e=document.querySelector("meta[name="+t+"]");return e?e.getAttribute("content"):null}function it(t,e,i){var n=i-e.startTimestamp,r=i&&(n>t||n<0);r&&(e.setStatus(y.DeadlineExceeded),e.setTag("maxTransactionDurationExceeded","true"))}var nt=function(){function t(e){e===void 0&&(e={}),this.name=t.id,this._router=e.router||e.app,this._methods=(Array.isArray(e.methods)?e.methods:[]).concat("use")}return t.prototype.setupOnce=function(){if(!this._router){p.error("ExpressIntegration is missing an Express instance");return}st(this._router,this._methods)},t.id="Express",t}();function me(t,e){var i=t.length;switch(i){case 2:return function(n,r){var s=r.__sentry_transaction;if(s){var a=s.startChild({description:t.name,op:"middleware."+e});r.once("finish",function(){a.finish()})}return t.call(this,n,r)};case 3:return function(n,r,s){var a,o=r.__sentry_transaction,d=(a=o)===null||a===void 0?void 0:a.startChild({description:t.name,op:"middleware."+e});t.call(this,n,r,function(){for(var f=[],c=0;c<arguments.length;c++)f[c]=arguments[c];var u;(u=d)===null||u===void 0||u.finish(),s.call.apply(s,E([this],f))})};case 4:return function(n,r,s,a){var o,d=s.__sentry_transaction,f=(o=d)===null||o===void 0?void 0:o.startChild({description:t.name,op:"middleware."+e});t.call(this,n,r,s,function(){for(var c=[],u=0;u<arguments.length;u++)c[u]=arguments[u];var m;(m=f)===null||m===void 0||m.finish(),a.call.apply(a,E([this],c))})};default:throw new Error("Express middleware takes 2-4 arguments. Got: "+i)}}function rt(t,e){return t.map(function(i){return typeof i=="function"?me(i,e):Array.isArray(i)?i.map(function(n){return typeof n=="function"?me(n,e):n}):i})}function at(t,e){var i=t[e];return t[e]=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return i.call.apply(i,E([this],rt(n,e)))},t}function st(t,e){e===void 0&&(e=[]),e.forEach(function(i){return at(t,i)})}var ot=function(){function t(){this.name=t.id}return t.prototype.setupOnce=function(e,i){var n=F("pg");if(!n){p.error("Postgres Integration was unable to require `pg` package.");return}Y(n.Client.prototype,"query",function(r){return function(s,a,o){var d,f,c,u=i().getScope(),m=(d=u)===null||d===void 0?void 0:d.getSpan(),g=(f=m)===null||f===void 0?void 0:f.startChild({description:typeof s=="string"?s:s.text,op:"db"});if(typeof o=="function")return r.call(this,s,a,function(_,h){var b;(b=g)===null||b===void 0||b.finish(),o(_,h)});if(typeof a=="function")return r.call(this,s,function(_,h){var b;(b=g)===null||b===void 0||b.finish(),a(_,h)});var v=typeof a!="undefined"?r.call(this,s,a):r.call(this,s);return ae(v)?v.then(function(_){var h;return(h=g)===null||h===void 0||h.finish(),_}):((c=g)===null||c===void 0||c.finish(),v)}})},t.id="Postgres",t}(),dt=function(){function t(){this.name=t.id}return t.prototype.setupOnce=function(e,i){var n=F("mysql/lib/Connection.js");if(!n){p.error("Mysql Integration was unable to require `mysql` package.");return}Y(n,"createQuery",function(r){return function(s,a,o){var d,f,c=i().getScope(),u=(d=c)===null||d===void 0?void 0:d.getSpan(),m=(f=u)===null||f===void 0?void 0:f.startChild({description:typeof s=="string"?s:s.sql,op:"db"});return typeof o=="function"?r.call(this,s,a,function(g,v,_){var h;(h=m)===null||h===void 0||h.finish(),o(g,v,_)}):typeof a=="function"?r.call(this,s,function(g,v,_){var h;(h=m)===null||h===void 0||h.finish(),a(g,v,_)}):r.call(this,s,a,o)}})},t.id="Mysql",t}(),ct=["aggregate","bulkWrite","countDocuments","createIndex","createIndexes","deleteMany","deleteOne","distinct","drop","dropIndex","dropIndexes","estimatedDocumentCount","find","findOne","findOneAndDelete","findOneAndReplace","findOneAndUpdate","indexes","indexExists","indexInformation","initializeOrderedBulkOp","insertMany","insertOne","isCapped","mapReduce","options","parallelCollectionScan","rename","replaceOne","stats","updateMany","updateOne"],ut={bulkWrite:["operations"],countDocuments:["query"],createIndex:["fieldOrSpec"],createIndexes:["indexSpecs"],deleteMany:["filter"],deleteOne:["filter"],distinct:["key","query"],dropIndex:["indexName"],find:["query"],findOne:["query"],findOneAndDelete:["filter"],findOneAndReplace:["filter","replacement"],findOneAndUpdate:["filter","update"],indexExists:["indexes"],insertMany:["docs"],insertOne:["doc"],mapReduce:["map","reduce"],rename:["newName"],replaceOne:["filter","doc"],updateMany:["filter","update"],updateOne:["filter","update"]},ft=function(){function t(e){e===void 0&&(e={}),this.name=t.id,this._operations=Array.isArray(e.operations)?e.operations:ct,this._describeOperations="describeOperations"in e?e.describeOperations:!0,this._useMongoose=!!e.useMongoose}return t.prototype.setupOnce=function(e,i){var n=this._useMongoose?"mongoose":"mongodb",r=F(n);if(!r){p.error("Mongo Integration was unable to require `"+n+"` package.");return}this._instrumentOperations(r.Collection,this._operations,i)},t.prototype._instrumentOperations=function(e,i,n){var r=this;i.forEach(function(s){return r._patchOperation(e,s,n)})},t.prototype._patchOperation=function(e,i,n){if(i in e.prototype){var r=this._getSpanContextFromOperationArguments.bind(this);Y(e.prototype,i,function(s){return function(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];var d,f,c,u,m=a[a.length-1],g=n().getScope(),v=(d=g)===null||d===void 0?void 0:d.getSpan();if(typeof m!="function"||i==="mapReduce"&&a.length===2){var _=(f=v)===null||f===void 0?void 0:f.startChild(r(this,i,a)),h=s.call.apply(s,E([this],a));return ae(h)?h.then(function(k){var w;return(w=_)===null||w===void 0||w.finish(),k}):((c=_)===null||c===void 0||c.finish(),h)}var b=(u=v)===null||u===void 0?void 0:u.startChild(r(this,i,a.slice(0,-1)));return s.call.apply(s,E([this],a.slice(0,-1),[function(k,w){var z;(z=b)===null||z===void 0||z.finish(),m(k,w)}]))}})}},t.prototype._getSpanContextFromOperationArguments=function(e,i,n){var r={collectionName:e.collectionName,dbName:e.dbName,namespace:e.namespace},s={op:"db",description:i,data:r},a=ut[i],o=Array.isArray(this._describeOperations)?this._describeOperations.includes(i):this._describeOperations;if(!a||!o)return s;try{if(i==="mapReduce"){var d=_e(n,2),f=d[0],c=d[1];r[a[0]]=typeof f=="string"?f:f.name||"<anonymous>",r[a[1]]=typeof c=="string"?c:c.name||"<anonymous>"}else for(var u=0;u<a.length;u++)r[a[u]]=JSON.stringify(n[u])}catch(m){}return s},t.id="Mongo",t}(),pt=Object.freeze({__proto__:null,Express:nt,Postgres:ot,Mysql:dt,Mongo:ft}),lt=l(l({},pt),{BrowserTracing:Ze});Ce();export{lt as Integrations};
