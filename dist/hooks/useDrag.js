import{useEffect as k,useRef as D}from"../../snowpack/pkg/preact/hooks.js";import m from"../../snowpack/pkg/pointer-tracker.js";import{cancelEvent as a,sub2d as E}from"../utils/index.js";import{useLatest as P}from"./useLatest.js";const u=-999,p=n=>({x:n.pageX,y:n.pageY});export const useDrag=(n,d)=>{const e=P(d),s=D(u);k(()=>{if(n==null)return;let o={x:0,y:0};const i=r=>{const t=p(r),c=E(t,o);return{start:o,delta:c,now:t}},g=new m(n,{start(r,t){return a(t),s.current!==u?!1:(s.current=r.id,o=p(r),e.current.onDragStart&&e.current.onDragStart({start:o}),!0)},move(r,t,c){a(c);const f=t.find(l=>l.id===s.current);f!=null&&e.current.onDrag&&e.current.onDrag(i(f))},end(r,t,c){a(t),r.id===s.current&&(s.current=u,e.current.onDragEnd&&e.current.onDragEnd(i(r)),o={x:0,y:0})},rawUpdates:!1});return()=>{g.stop()}},[e,n])};
